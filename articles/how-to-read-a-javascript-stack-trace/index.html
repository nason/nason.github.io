<!DOCTYPE html><html lang=en><head><title>How to Read a JavaScript Stack Trace | Michael Nason | Particles &amp; Waves</title><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=apple-mobile-web-app-status-bar-style content=black-translucent><meta name=viewport content="width=device-width,initial-scale=1,minimal-ui"><meta name=description content="Understanding a stack trace is an essential skill for any software developer. In this post, I’ll show you how to read a stack trace and give an example of how to use a stack trace to debug client-side JavaScript."><meta name=keywords content=""><meta property=profile:first_name content="Michael"><meta property=profile:last_name content="Nason"><meta property=og:title content="How to Read a JavaScript Stack Trace | Michael Nason"><meta property=og:type content="website"><meta property=og:url content="https://nason.us/articles/how-to-read-a-javascript-stack-trace/"><meta property=og:image content="https://nason.us/articles/how-to-read-a-javascript-stack-trace/callstack.9641fcff.png"><meta name=signet:authors content="Michael Nason"><meta name=signet:links content="https://github.com/nason, https://twitter.com/nasonosan, http://nason.us"><link rel=alternate href=https://nason.us/feed.xml type=application/rss+xml title="Michael Nason"><script>// HTTPS only
    var host = "nason.us";
    if ((host === window.location.host) && (window.location.protocol !== "https:"))
        window.location.protocol = "https";</script><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,300italic" rel=stylesheet type="text/css"><link rel=stylesheet href="/css/main.css"><script src=/js/vendor/head.56c0d4a6.js data-headjs-load=/js/init.03c2b362.js></script><!--[if lte IE 8]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script><![endif]--></head><body><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44577443-1', 'nason.us');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');</script><div class=mobile-background></div><main id=post><section id=page-header><header><p>Blog</p><h1><a href="/">Michael Nason</a></h1><p>Particles &amp; Waves</p><ul class=icons><li><a href=https://github.com/nason class=icon-git></a></li><li><a href=https://linkedin.com/in/michaelnason class=icon-linkedin></a></li><li><a href=/#contact class="icon-mail scroll"></a></li></ul></header></section><article class="container box style3"><header><h2><a href="/articles/how-to-read-a-javascript-stack-trace/">How to Read a JavaScript Stack Trace</a></h2><p class=date><span>October 08, 2013</span></p></header><section><p>Understanding a stack trace is an essential skill for any software developer. In this post, I’ll show you how to read a stack trace and give an example of how to use a stack trace to debug client-side JavaScript.<span class="more"></p><p>A <strong>stack trace</strong> is a snapshot of a program at a specific moment during a its runtime. It gives you access to useful information about the execution of your code,&nbsp;like:</p><ul><li>The call stack</li><li>Closure scope</li><li>Local variables</li></ul><h2 id=our-example>Our Example</h2><p>We’ll be adding some simple functionality to a basic webpage. I won’t focus too much on the <span class=caps>HTML</span> or <span class=caps>CSS</span>, let’s assume those are ready. Here’s where we’ll&nbsp;start:</p><pre><code class=lang-html><span class=tag>&lt;<span class=title>script</span> <span class=attribute>src</span>=<span class=value>"http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"</span>&gt;</span><span class=javascript></span><span class=tag>&lt;/<span class=title>script</span>&gt;</span>
<span class=tag>&lt;<span class=title>script</span> <span class=attribute>src</span>=<span class=value>"http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"</span>&gt;</span><span class=javascript></span><span class=tag>&lt;/<span class=title>script</span>&gt;</span>
<span class=tag>&lt;<span class=title>script</span>&gt;</span><span class=javascript>
  $(<span class=function><span class=keyword>function</span><span class=params>()</span> {</span>
    $(<span class=string>'form'</span>).submit(<span class=function><span class=keyword>function</span><span class=params>(evt)</span> {</span>
      evt.preventDefault();
      console.log(<span class=string>'Form submitted:'</span>, $(<span class=keyword>this</span>).find(<span class=string>'input'</span>).val() );
      $(<span class=keyword>this</span>).find(<span class=string>'input'</span>).val(<span class=string>''</span>);
    })
  })
</span><span class=tag>&lt;/<span class=title>script</span>&gt;</span>

<span class=tag>&lt;<span class=title>form</span>&gt;</span>
  <span class=tag>&lt;<span class=title>p</span>&gt;</span><span class=tag>&lt;<span class=title>input</span> <span class=attribute>type</span>=<span class=value>"text"</span> <span class=attribute>placeholder</span>=<span class=value>"Enter your text here"</span> /&gt;</span><span class=tag>&lt;/<span class=title>p</span>&gt;</span>
  <span class=tag>&lt;<span class=title>p</span>&gt;</span><span class=tag>&lt;<span class=title>button</span>&gt;</span>Submit<span class=tag>&lt;/<span class=title>button</span>&gt;</span><span class=tag>&lt;/<span class=title>p</span>&gt;</span>
<span class=tag>&lt;/<span class=title>form</span>&gt;</span>
<span class=tag>&lt;<span class=title>div</span> <span class=attribute>class</span>=<span class=value>"letter-display"</span>&gt;</span><span class=tag>&lt;/<span class=title>div</span>&gt;</span>
</code></pre><p>This simple example logs whatever is in the input field whenever the button is clicked, and then clears the input field. Not much to it,&nbsp;right?</p><h2 id=time-to-get-funky>Time To Get&nbsp;Funky</h2><p>Now lets step it up a notch and append the form input to the page, one letter per line, <span class=caps>AND</span> give each letter a random&nbsp;color.</p><p>Here’s one way you could modify the inline <code>script</code> tag to implement this&nbsp;behavior:</p><pre><code class=lang-javascript><span class=comment>// Lets setup a funky (and broken) function that will iterate though a string, and append each letter to the page with a random color</span>
<span class=keyword>var</span> displayLetters = <span class=function><span class=keyword>function</span><span class=params>(string)</span> {</span>
  <span class=keyword>var</span> input = string.split(<span class=string>''</span>);
  <span class=keyword>var</span> color = [<span class=number>0</span>,<span class=number>0</span>,<span class=number>0</span>];

  <span class=comment>// Iterate through r, g, and b and assign a random value</span>
  _.each(color, <span class=function><span class=keyword>function</span><span class=params>(code, i, color)</span> {</span>
    color[i] = <span class=built_in>Math</span>.floor(<span class=built_in>Math</span>.random() * <span class=number>256</span>);
  });

  <span class=keyword>while</span>( input.length ) {
    <span class=comment>// Append the letter and apply the color</span>
    <span class=keyword>var</span> letter = input.shift();
    <span class=keyword>var</span> nextString = input.join(<span class=string>''</span>);
    <span class=keyword>var</span> randoRgba = <span class=string>"rgba("</span> + color.join(<span class=string>','</span>) + <span class=string>",1)"</span>;

    $(<span class=string>'.letter-display'</span>).append( $(<span class=string>'&lt;p /&gt;'</span>).text( letter ).css(<span class=string>'color'</span>, randoRgba ) );
    displayLetters(nextString);
  }
};

$(<span class=function><span class=keyword>function</span><span class=params>()</span> {</span>
  $(<span class=string>'form'</span>).submit(<span class=function><span class=keyword>function</span><span class=params>(evt)</span> {</span>
    evt.preventDefault();
    displayLetters( $(<span class=keyword>this</span>).find(<span class=string>'input'</span>).val() )
    console.log(<span class=string>'Form submitted:'</span>, $(<span class=keyword>this</span>).find(<span class=string>'input'</span>).val() );
    $(<span class=keyword>this</span>).find(<span class=string>'input'</span>).val(<span class=string>''</span>);
  })
})
</code></pre><h2 id=things-get-weird>Things Get Weird</h2><p>The code looks good, but if you try it you’ll notice that something is off…This is what I saw when I entered&nbsp;“<span class=caps>ABCD</span>”:</p><p><img src=/articles/how-to-read-a-javascript-stack-trace/broken_demo.15899cae.png alt=broken_demo></p><p><strong>Uhh?</strong> The colors are nice and random, but there are way too many letters there! <em>(Note: I cropped the image, it actually went on a bit&nbsp;further)</em></p><p>Now, if you’re a seasoned JavaScript dev you’ll be able to squash this bug in no time. This post’s not for&nbsp;you.</p><p>If you were to run into this situation and think game over, I’d like to introduce you to my friend…<code>debugger</code></p><h3 id=chrome-devtools>Chrome DevTools</h3><p>My examples will point to specific features of Chrome’s Developer Tools. Most browsers offer some form of debugging tools, natively or via extension, but I like&nbsp;Chrome’s.</p><h2 id=the-debugger-statement>The <code>debugger</code> Statement</h2><p>Simply add a debugger to the part of your code that isn’t meeting your expectations, fire open the Chrome Dev Tools (Command + Option + J on a Mac), and refresh the&nbsp;page.</p><pre><code class=lang-javascript><span class=keyword>while</span>( input.length ) {
  debugger;
  <span class=comment>// Append the letter and apply the color</span>
  <span class=keyword>var</span> letter = input.shift();
  <span class=keyword>var</span> nextString = input.join(<span class=string>''</span>);
  <span class=keyword>var</span> randoRgba = <span class=string>"rgba("</span> + color.join(<span class=string>','</span>) + <span class=string>",1)"</span>;

  $(<span class=string>'.letter-display'</span>).append( $(<span class=string>'&lt;p /&gt;'</span>).text( letter ).css(<span class=string>'color'</span>, randoRgba ) );
  displayLetters(nextString);
}
</code></pre><p>Now, your script will pause execution when it hits this statement. In this case, that will happen once you submit some text in the form. The <strong>Sources</strong> panel has all kinds of information that will help you debug this&nbsp;code:</p><p><img src=/articles/how-to-read-a-javascript-stack-trace/debugger.a394809d.png alt=debugger></p><p><span class=caps>OK</span>, that’s a lot to take in there. Let’s go through some of the&nbsp;components:</p><h3 id=devtools-toolbar>DevTools Toolbar</h3><p><img src=/articles/how-to-read-a-javascript-stack-trace/devtools-toolbar.ecd26e42.png alt="devtools toolbar"></p><p>These are your debugger ‘home keys.’ Know them. Use them. They will be good to&nbsp;you.</p><p><strong>The first 4 are the big ones</strong>. From left to right they&nbsp;are:</p><ul><li><strong>Resume Execution</strong>. This one does what it says and un-pauses your script, until the <code>debugger</code> statement is hit&nbsp;again.</li><li><strong>Step Over</strong>. Execute the current line (highlighted in blue) and proceed to the next line, but don’t execute it&nbsp;yet.</li><li><strong>Step In</strong>. If the current line calls a function, step into that function in the&nbsp;debugger.</li><li><strong>Step Out</strong>. The opposite of <em>Step In</em>. Returns you to the function you stepped in <em>from.</em></li><li>Ignore Breakpoints. Disables pausing on&nbsp;breakpoints.</li><li>Ignore Exception. Disables pausing on&nbsp;exceptions.</li></ul><h3 id=fast-forward>Fast Forward</h3><p>I went ahead and hit the <strong>Resume Execution</strong> button four times and let the debugger stop there, because that’s where my script stopped behaving as intended and things get interesting. My debugger looks like so&nbsp;now:</p><p><img src=/articles/how-to-read-a-javascript-stack-trace/callstack.9641fcff.png alt=callstack></p><h3 id=scope-variables>Scope Variables</h3><p>On the right are your scope variables <em>at this moment</em> in the execution of this program (which is paused exactly where you want it). How very&nbsp;useful!</p><p>So lets see, nextString has a length of 1, so the next step <em>really should</em> be the last iteration of the while loop, because after that input.length will be falsey, right? Well… we know the answer is no, because it clearly doesn’t&nbsp;stop.</p><h3 id=whats-in-your-call-stack->Whats In Your Call&nbsp;Stack?</h3><p>On the left is your <strong>call stack</strong>. It’s kinda like the stack data structure, and represents the <strong>last-in-first-out</strong> execution order of functions that have been called. The <em>most recently called function</em> is on top. Once a function finishes executing, it <em>pops</em> off the top and allows the function that invoked it to resume&nbsp;execution.</p><p><strong>Clicking on a function in the call stack will show you the code that is ‘paused’, waiting for other functions to finish. It will also show you that function’s local scope variables at that exact moment of&nbsp;execution.</strong></p><p>Lets see, displayLetters on top there, 3 times. It is a recursive function and calls itself, so that makes sense. But it doesn’t stop when it is meant&nbsp;to..</p><h2 id=using-the-call-stack-to-debug-a-recursive-function>Using the Call Stack to Debug a Recursive&nbsp;Function</h2><p>So, what’s wrong with our function? Let’s click <strong>Resume Execution</strong> one more time to see where it goes&nbsp;wrong:</p><p><img src=/articles/how-to-read-a-javascript-stack-trace/callstack2.43f6e8e9.png alt=callstack2></p><p>What?! Why is nextString now “<span class=caps>CD</span>”? It was “D” the last time this function call hit the debugger. Let’s click on the next function call in the stack and see what its scope looks&nbsp;like:</p><p><img src=/articles/how-to-read-a-javascript-stack-trace/callstack3.3e3c5090.png alt=callstack3></p><p>Remember, this is a snapshot of what the scope was <strong>back in time</strong>, when this function yielded execution to another&nbsp;function.</p><p>I think I see what’s wrong now. <strong>Do&nbsp;you?</strong></p><h2 id=bubbling-functions>Bubbling Functions</h2><p>Once a function returns, it’s caller resumes execution where it left off. In this case, that’s in the middle of a while&nbsp;loop…</p><p>Intuitively, the code provided in this example might feel right. But when any of the child functions return, its parent function will continue its loop to the next letter, call itself, yield execution, and start this process over&nbsp;again.</p><p>The call stack can help you observe the processes going on during the execution of your JavaScript, and give you a snapshot of each function&nbsp;call.</p><p>In this case, its a pretty simple fix. Either our while loop is unnecessary, or the function should parse the input iteratevely, not recursively. Here’s one quick solution, changing the while loop to an if&nbsp;statement:</p><pre><code class=lang-javascript><span class=keyword>if</span>( input.length ) {
  <span class=comment>// Append the letter and apply the color</span>
  <span class=keyword>var</span> letter = input.shift();
  <span class=keyword>var</span> nextString = input.join(<span class=string>''</span>);
  <span class=keyword>var</span> randoRgba = <span class=string>"rgba("</span> + color.join(<span class=string>','</span>) + <span class=string>",1)"</span>;

  $(<span class=string>'.letter-display'</span>).append( $(<span class=string>'&lt;p /&gt;'</span>).text( letter ).css(<span class=string>'color'</span>, randoRgba ) );
  displayLetters(nextString);
}
</code></pre><h2 id=in-the-real-world>In The Real&nbsp;World</h2><p>The call stack and dev tools are invaluable tools that can make debugging much less of a hassle, and help you follow the execution of your&nbsp;program.</p><p>This was a super simple example, but the same concepts apply to any of your code. Now go debug your&nbsp;code!</p></section><footer><div id=disqus_thread></div><script type=text/javascript>var disqus_shortname = 'nason';
    var disqus_identifier = '/articles/how-to-read-a-javascript-stack-trace/';
    var disqus_title = 'How to Read a JavaScript Stack Trace';
    var disqus_url = 'https://nason.us//articles/how-to-read-a-javascript-stack-trace/';

      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></footer></article><article class="container box style2"><header><h2><a href="/blog/">&larr; Return to Blog</a></h2></header></article><footer id=footer><div class=article-footer-bg-overlay><section class="about container"><p>Thank you for visiting my site. I hope you enjoyed your stay. This static site is built using open-source tools, and I have published its source publicly on <a href=https://github.com/nason/nason.github.io/tree/source>GitHub</a>.</p><p>I build software with Node.js, JavaScript, Backbone, <span class=caps>HTML5</span>, <span class=caps>CSS3</span>, Ruby on Rails and many others. Previously, I founded Zip Eyewear. <a href="/about/">More about&nbsp;me→</a></p></section><section class=copyright><ul class=menu><li><span xmlns:dct="http://purl.org/dc/terms/" property=dct:title>Particles & Waves</span> by <a xmlns:cc=http://creativecommons.org/ns# href=http://nason.us property=cc:attributionName rel=cc:attributionURL>Michael Nason</a> is licensed under a <a rel=license href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a></li><li>Generated with <a href="http://wintersmith.io/">Wintersmith</a></li><li>Design forked from Overflow by <a href="http://html5up.net/">HTML5 UP</a></li></ul><a rel=license href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style=border-width:0 src="/images/cc_4_88x31.35987e13.png"></a></section></div></footer></main></body></html>